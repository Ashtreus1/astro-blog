import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r}from"./index.DH0ko44-.js";import{s as i,I as f,B as p}from"./supabaseClient.-23kbNNv.js";function b({ticketId:t,senderType:l,messages:a,appendMessage:c}){const[n,u]=r.useState(""),m=r.useRef(null);r.useEffect(()=>{const s=i.channel(`messages-${t}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`ticket_id=eq.${t}`},o=>c(o.new)).subscribe();return()=>i.removeChannel(s)},[t,c]),r.useEffect(()=>{m.current?.scrollIntoView({behavior:"smooth"})},[a]);const x=async s=>{s.preventDefault(),n.trim()&&(await i.from("messages").insert([{ticket_id:t,content:n,sender:l}]),l==="customer"&&await fetch("/api/bot-reply",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ticketId:t,userMessage:n})}),u(""))};return e.jsxs("div",{className:"flex flex-col flex-1 justify-between h-full p-4",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-2 mb-4",children:[a.length===0?e.jsx("p",{className:"text-gray-400 italic",children:"No messages yet."}):a.map((s,o)=>e.jsxs("div",{className:`p-2 rounded max-w-prose text-sm ${s.sender==="support"?"bg-blue-100":"bg-green-100"}`,children:[e.jsxs("div",{children:[e.jsx("strong",{children:s.sender})," ",e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.created_at).toLocaleTimeString()})]}),e.jsx("div",{children:s.content})]},o)),e.jsx("div",{ref:m})]}),e.jsxs("form",{onSubmit:x,className:"flex gap-2",children:[e.jsx(f,{value:n,onChange:s=>u(s.currentTarget.value),placeholder:"Type message..."}),e.jsx(p,{type:"submit",children:"Send"})]})]})}export{b as M};
